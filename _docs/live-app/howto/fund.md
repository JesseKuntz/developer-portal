---
title: Fund
subtitle:
tags: [platform app, platform application, live app, ledger live app]
category: Platform Application
toc: true
layout: doc_la
---

## Introduction

To secure the funding of the card, Ledger developed an exchange app that you are able to call in your iframe through the device Ledger Live Widget API. You will have to modify your web service to generate the appropriate request for the exchange app. In this document, we will guide you through this process.

As you can see on the following diagram, there are three interactions between Ledger Live and your iframe. This three interactions are the ones that are needed from your side.  

![Secure funding high level design](../../images/baanx-secure-funding.png "Secure funding high level design")

The three main functions you need for the funding are: 
- List the accounts: `listAccounts`,
- Start the exchange: `initExchange`,
- Complete the exchange (**payload and R,S** in the diagram): `completeExchange`.


## List accounts

List the accounts added by the user on Ledger Live.

[listAccounts](../../classes/#listaccounts):

```json
async listAccounts(): Promise<Account[]> {
    const rawAccounts = await this._request<RawAccount[]>("account.list");

    return rawAccounts.map(deserializeAccount);
  }
```

## Start exchange

Start the exchange process by generating a nonce on Ledger device.

[initExchange](../../classes/#initexchange):

```json
 async initExchange(
    _exchangeType: ExchangeType,
    _partnerName: string
  ): Promise<string> {
    throw new Error("Function is not implemented yet");
  }
```


## Complete exchange

Complete an exchange process by passing by the exchange content and its signature.

[completeExchange](../../classes/#completeexchange):

```json
async completeExchange(
    _exchangePayload: ExchangePayload,
    _payloadSignature: EcdsaSignature,
    _txFeesLevel: FeesLevel
  ): Promise<void> {
    throw new Error("Function is not implemented yet");
  }
```

The **exchangePayload** is a protobuf message containing the transaction data. It is generated by the provider and sent to Ledger Live. 

Your protobuf message should have the following structure: 

```json
message NewFundResponse {
   string    user_id = 1; 
   string    account_name = 2; 
   string    in_currency = 3; 
   bytes     in_amount = 4; 
   string    in_address = 5; 
   bytes    device_transaction_id = 6; 
}
```

Explanation of each fields:
- `user_id`: the client ID.
- `account_name`: the funded account name (example: Card 1234).
- `in_currency`: the currency that the client wants to use to fund.
- `in_amount`: the amount of **in_currency** that the client wants to fund.
- `in_address`: the account of the client.
- `device_transaction_id`: the fund transaction nonce provided by the client at initialization.

